def map=[:]
pipeline {
    agent any
    stages {
//         stage ('从git仓库拉取代码阶段') {
//             steps{
//                 echo "----------------------从git仓库拉取代码阶段------------------"
//                 timeout(time:3, unit:'MINUTES') {
//                     git branch: 'main', credentialsId: '5c26cc66-ec4d-40aa-a261-58f29df53b76', url: 'git@github.com:metrosir/test.git'
//                 }
//             }
//         }
        stage ('debug') {
            steps {
                echo "echo map>>"
                echo "GIT_BRANCH:" + GIT_BRANCH
                echo "BUILD_TAG:" + BUILD_TAG
//                 echo "BUILD_PROJECT_NAME:" + BUILD_PROJECT_NAME
                echo "GIT_PREVIOUS_COMMIT:" + GIT_PREVIOUS_COMMIT
//                 echo "GIT_LOCAL_BRANCH:" + GIT_LOCAL_BRANCH
                echo "GIT_PREVIOUS_SUCCESSFUL_COMMIT:" + GIT_PREVIOUS_SUCCESSFUL_COMMIT
                echo "echo map<<"
            }
        }
        stage ('build image') {
            steps {
                echo "----------------------生产docker镜像------------------"
                sh label:'image building', script: '/bin/sh deploy/sh/toimage.sh'
            }
        }
        stage('deploy k8s') {

           steps {
                echo "----------------------部署到k8s------------------"
                sh label:'deploy image to k8s', script: '/bin/sh deploy/sh/tok8s.sh'
           }
        }
    }

    post{
        success {
            cleanWs()
        }
    }
}


// pipeline {
//     agent { docker 'golang:1.18.3' }
//     stages {
//         stage('build') {
//             steps {
//                 sh 'go env'
//             }
//         }
//     }
// }

// https://www.jenkins.io/zh/doc/pipeline/tour/running-multiple-steps/